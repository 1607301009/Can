C51 COMPILER V9.60.0.0   MAIN______________                                                06/23/2021 00:25:49 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN______________
OBJECT MODULE PLACED IN .\Objects\main - ∏±±æ - ∏±±æ.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main - ∏±±æ - ∏±±æ.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\main - ∏±±æ - ∏±±æ.lst) TABS(2) OBJECT(.\Objects\main - ∏±±æ - ∏±±æ.obj)

line level    source

   1          #include "STC89C5xRC.H"
   2          #include <intrins.h>
   3          
   4          #define uint unsigned int
   5          #define uchar unsigned char
   6          unsigned char sec; //ÂÆö‰πâËÆ°Êï∞ÂÄºÔºåÊØèËøá1 ÁßíÔºåsec Âä†1
   7          unsigned int tcnt; //ÂÆöÊó∂‰∏≠Êñ≠Ê¨°Êï∞
   8          bit write = 0; //ÂÜô24C08 ÁöÑÊ†áÂøóÔºõ
   9          sbit sda = P2 ^0; //IIC Êé•Âè£SDA ÂÆö‰πâ
  10          sbit scl = P2 ^1; //IIC Êé•Âè£SCL ÂÆö‰πâ
  11          sbit dula = P2 ^6;
  12          sbit wela = P2 ^7;
  13          unsigned char j, k;
  14          
  15          void delay(unsigned char i) //Âª∂Êó∂Á®ãÂ∫è
  16          {
  17   1          for (j = i; j > 0; j--)
  18   1              for (k = 125; k > 0; k--);
  19   1      }
  20          
  21          uchar code
  22          table[]={
  23          0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d, //Êï∞Á†ÅÁÆ°ÁºñÁ†Å
  24          0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  25          
  26          void display(uchar bai_c, uchar sh_c) //ÊòæÁ§∫Á®ãÂ∫è
  27          {
  28   1          dula = 0;
  29   1          P0 = table[bai_c]; //ÊòæÁ§∫Áôæ‰Ωç
  30   1          dula = 1;
  31   1          dula = 0;
  32   1          wela = 0;
  33   1          P0 = 0x7e;
  34   1          wela = 1;
  35   1          wela = 0;
  36   1          delay(5);
  37   1          dula = 0;
  38   1          P0 = table[sh_c]; //ÊòæÁ§∫ÂçÅ‰Ωç
  39   1          dula = 1;
  40   1          dula = 0;
  41   1          wela = 0;
  42   1          P0 = 0x7d;
  43   1          wela = 1;
  44   1          wela = 0;
  45   1          delay(5);
  46   1      }
  47          
  48          /////////24C02 ËØªÂÜôÈ©±Âä®Á®ãÂ∫è////////////////////
  49          void delay1(unsigned char x) //Âª∂Êó∂Â≠êÂáΩÊï∞
  50          {
  51   1          unsigned int i;
  52   1          for (i = 0; i < x; i++);
  53   1      }
  54          
C51 COMPILER V9.60.0.0   MAIN______________                                                06/23/2021 00:25:49 PAGE 2   

  55          void flash() //Âª∂Êó∂Â≠êÂáΩÊï∞
  56          { ;; }
  57          
  58          void x24c08_init() //24c02 ÂàùÂßãÂåñÂ≠êÁ®ãÂ∫è
  59          {
  60   1          scl = 1;
  61   1          flash();
  62   1          sda = 1;
  63   1          flash();
  64   1      }
  65          
  66          void start() //ÂêØÂä®I2C ÊÄªÁ∫ø
  67          {
  68   1          sda = 1;
  69   1          flash();
  70   1          scl = 1;
  71   1          flash();
  72   1          sda = 0;
  73   1          flash();
  74   1          scl = 0;
  75   1          flash();
  76   1      }
  77          
  78          void stop() //ÂÅúÊ≠¢I2C ÊÄªÁ∫ø
  79          {
  80   1          sda = 0;
  81   1          flash();
  82   1          scl = 1;
  83   1          flash();
  84   1          sda = 1;
  85   1          flash();
  86   1      }
  87          
  88          void writex(unsigned char j) //ÂÜô‰∏Ä‰∏™Â≠óËäÇ
  89          {
  90   1          unsigned char i, temp;
  91   1          temp = j;
  92   1          for (i = 0; i < 8; i++) {
  93   2              temp = temp << 1;
  94   2              scl = 0;
  95   2              flash();
  96   2              sda = CY;
  97   2              flash();
  98   2              scl = 1;
  99   2              flash();
 100   2          }
 101   1          scl = 0;
 102   1          flash();
 103   1          sda = 1;
 104   1          flash();
 105   1      }
 106          
 107          unsigned char readx() //ËØª‰∏Ä‰∏™Â≠óËäÇ
 108          {
 109   1          unsigned char i, j, k = 0;
 110   1          scl = 0;
 111   1          flash();
 112   1          sda = 1;
 113   1          for (i = 0; i < 8; i++) {
 114   2              flash();
 115   2              scl = 1;
 116   2              flash();
C51 COMPILER V9.60.0.0   MAIN______________                                                06/23/2021 00:25:49 PAGE 3   

 117   2              if (sda == 1) j = 1;
 118   2              else j = 0;
 119   2              k = (k << 1) | j;
 120   2              scl = 0;
 121   2          }
 122   1          flash();
 123   1          return (k);
 124   1      }
 125          
 126          void clock() //I2C ÊÄªÁ∫øÂ∫îÁ≠îÂ≠êÂáΩÊï∞
 127          {
 128   1          unsigned char i = 0;
 129   1          scl = 1;
 130   1          flash();
 131   1          while ((sda == 1) && (i < 255))i++;
 132   1          scl = 0;
 133   1          flash();
 134   1      }
 135          
 136          ////////‰ªé24c02 ÁöÑÂú∞ÂùÄaddress ‰∏≠ËØªÂèñ‰∏Ä‰∏™Â≠óËäÇÊï∞ÊçÆ/////
 137          unsigned char x24c08_read(unsigned char address) {
 138   1          unsigned char i;
 139   1          start();
 140   1          writex(0xa0);
 141   1          clock();
 142   1          writex(address);
 143   1          clock();
 144   1          start();
 145   1          writex(0xa1);
 146   1          clock();
 147   1          i = readx();
 148   1          stop();
 149   1          delay1(10);
 150   1          return (i);
 151   1      }
 152          
 153          //////Âêë24c02 ÁöÑaddress Âú∞ÂùÄ‰∏≠ÂÜôÂÖ•‰∏ÄÂ≠óËäÇÊï∞ÊçÆinfo/////
 154          void x24c08_write(unsigned char address, unsigned char info) {
 155   1          EA = 0;
 156   1          start();
 157   1          writex(0xa0);
 158   1          clock();
 159   1          writex(address);
 160   1          clock();
 161   1          writex(info);
 162   1          clock();
 163   1          stop();
 164   1          EA = 1;
 165   1          delay1(50);
 166   1      }
 167          
 168          void t0(void)
 169          
 170          interrupt 1 using 0 //ÂÆöÊó∂‰∏≠Êñ≠ÊúçÂä°ÂáΩÊï∞
 171          {
 172   1      TH0 = (65536 - 50000) / 256; //ÂØπTH0 TL0 ËµãÂÄº
 173   1      TL0 = (65536 - 50000) % 256; //ÈáçË£ÖËÆ°Êï∞ÂàùÂÄº
 174   1      tcnt++; //ÊØèËøá250ust tcnt Âä†‰∏Ä
 175   1      if(tcnt==20) //ËÆ°Êª°20 Ê¨°Ôºà1 ÁßíÔºâÊó∂
 176   1      {
 177   2      tcnt = 0; //ÈáçÊñ∞ÂÜçËÆ°
 178   2      sec++;
C51 COMPILER V9.60.0.0   MAIN______________                                                06/23/2021 00:25:49 PAGE 4   

 179   2      write = 1; //1 ÁßíÂÜô‰∏ÄÊ¨°24C02
 180   2      if(sec==100) //ÂÆöÊó∂100 ÁßíÔºåÂú®‰ªéÈõ∂ÂºÄÂßãËÆ°Êó∂
 181   2      {
 182   3      sec = 0;
 183   3      }
 184   2      }
 185   1      }
 186          
 187          void main() //‰∏ªÂáΩÊï∞
 188          {
 189   1          unsigned char i;
 190   1          TMOD = 0x01; //ÂÆöÊó∂Âô®Â∑•‰ΩúÂú®ÊñπÂºè1
 191   1          ET0 = 1;
 192   1          EA = 1; //ÂºÄ‰∏≠Êñ≠
 193   1          x24c08_init(); //ÂàùÂßãÂåñ24C08
 194   1          sec = x24c08_read(2); //ËØªÂá∫‰øùÂ≠òÁöÑÊï∞ÊçÆËµã‰∫ésec
 195   1          TH0 = (65536 - 50000) / 256; //ÂØπTH0 TL0 ËµãÂÄº
 196   1          TL0 = (65536 - 50000) % 256; //‰ΩøÂÆöÊó∂Âô®0.05 Áßí‰∏≠Êñ≠‰∏ÄÊ¨°
 197   1          TR0 = 1; //ÂêØÂä®ÂÆöÊó∂Âô®
 198   1          while (1) {
 199   2              i = 10;
 200   2              while (i--) { display(sec / 10, sec % 10); }
 201   2              if (write == 1) //Âà§Êñ≠ËÆ°Êó∂Âô®ÊòØÂê¶ËÆ°Êó∂‰∏ÄÁßí
 202   2              {
 203   3                  write = 0; //Ê∏ÖÈõ∂
 204   3                  x24c08_write(2, sec); //Âú®24c02 ÁöÑÂú∞ÂùÄ2 ‰∏≠ÂÜôÂÖ•Êï∞ÊçÆsec
 205   3              }
 206   2          }
 207   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    450    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
